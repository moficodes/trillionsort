apiVersion: batch/v1
kind: Job
metadata:
  name: generate
spec:
  ttlSecondsAfterFinished: 100
  completions: 25
  parallelism: 10
  completionMode: Indexed
  template:
    spec:
      securityContext:
        runAsUser: 65534
        runAsGroup: 65534
        fsGroup: 65534
      volumes:
        - name: filestore
          persistentVolumeClaim:
            claimName: podpvc
            readOnly: false
      containers:
      - name: generate
        image: moficodes/generate:v0.0.7
        command:
          - "/generate"
        args: ["-count", "100_000_000", "-file", "data/demo.txt", "-fileindex", "$(JOB_COMPLETION_INDEX)"]
        volumeMounts:
          - name: filestore
            mountPath: "/data"
        resources:
          requests:
            memory: "4Gi"
            cpu: "4"
          limits:
            memory: "4Gi"
            cpu: "4"
      restartPolicy: Never
